<h1 align="center">
  <!-- Logo -->
  <img src="https://user-images.githubusercontent.com/4985201/115444712-ca550500-a1c9-11eb-9897-238ece59129c.png" height="118"/>
  <br/>
  @marko/vite
	<br/>

  <!-- Language -->
  <a href="http://typescriptlang.org">
    <img src="https://img.shields.io/badge/%3C%2F%3E-typescript-blue.svg" alt="TypeScript"/>
  </a>
  <!-- Format -->
  <a href="https://github.com/prettier/prettier">
    <img src="https://img.shields.io/badge/styled_with-prettier-ff69b4.svg" alt="Styled with prettier"/>
  </a>
  <!-- CI -->
  <a href="https://github.com/marko-js/vite/actions/workflows/ci.yml">
    <img src="https://github.com/marko-js/vite/actions/workflows/ci.yml/badge.svg" alt="Build status"/>
  </a>
  <!-- Coverage -->
  <a href="https://coveralls.io/github/marko-js/vite">
    <img src="https://img.shields.io/coveralls/marko-js/vite.svg" alt="Test Coverage"/>
  </a>
  <!-- NPM Version -->
  <a href="https://npmjs.org/package/@marko/vite">
    <img src="https://img.shields.io/npm/v/@marko/vite.svg" alt="NPM Version"/>
  </a>
  <!-- Downloads -->
  <a href="https://npmjs.org/package/@marko/vite">
    <img src="https://img.shields.io/npm/dm/@marko/vite.svg" alt="Downloads"/>
  </a>
</h1>

A Marko plugin for [Vite](https://vitejs.dev/).

# Installation

```console
npm install @marko/vite
```

# Example config

```javascript
import { defineConfig } from "vite";
import marko from "@marko/vite";
export default defineConfig({
  plugins: [marko()]
});

```

# Linked Mode

By default this plugin operates in `linked` mode (you can disabled this by passing [`linked: false` as an option](#options.linked)). In `linked` mode the plugin automatically discovers all of the entry `.marko` files while compiling the server, and tells `Vite` which modules to load in the browser.

With this you _do not_ create `.html` files for `Vite`, it's Marko all the way down!
Scripts/styles and other content that _would have_ been injected into the `.html` files is instead made available via the `<vite>` tag.

## `<vite>` tag

In [linked mode](#linked-mode) you have access to the `<vite>` tag which will write out links assets generated for the browser by `Vite`.

The tag requires that a `slot` attribute is passed, and that it is a string matching `'head' | 'body' | 'head-prepend' | 'body-prepend'`. This lines up with `Vite`'s `injectTo` return value on the [transformIndexHtml hook](https://vitejs.dev/guide/api-plugin.html#transformindexhtml).

The tag also accepts the following additional attributes:

* **scriptAttrs**: Additional attributes to add onto every `<script>`.
* **inlineScriptAttrs**: Additional attributes to add onto every inline `<script>...</script>`.
* **externalScriptAttrs**: Additional attributes to add onto every external `<script src="..."></script>`.
* **styleAttrs**: Additional attributes to add onto every `<style>` or `<link rel="stylesheet">`.
* **inlineStyleAttrs**: Additional attributes to add onto every inline `<style>...</style>`.
* **externalStyleAttrs**: Additional attributes to add onto every external `<link rel="stylesheet" href="...">`.

TODO, example, mention default.

### [CSP Nonce Support](https://content-security-policy.com/nonce/)
Like the scripts generated by Marko itself, if you provide a [global `cspNonce`](https://markojs.com/docs/rendering/#global-data) when rendering the template on the server, a `nonce` attribute will be automatically added to any assets output by `vite`.

# Options

### options.babelConfig

You can manually override the Babel configuration used by passing a `babelConfig` object to the `@marko/vite` plugin. By default Babels regular [config file resolution](https://babeljs.io/docs/en/config-files) will be used.

```javascript
marko({
  babelConfig: {
    presets: ["@babel/preset-env"],
  },
});
```

### options.runtimeId

In some cases you may want to embed multiple isolated copies of Marko on the page. Since Marko relies on some `window` properties to initialize this can cause issues. For example, by default Marko will read the server rendered hydration code from `window.$components`. In Marko you can change these `window` properties by rendering with `{ $global: { runtimeId: "MY_MARKO_RUNTIME_ID" } }` as input on the server side.

This plugin exposes a `runtimeId` option produces output that automatically sets `$global.runtimeId` on the server side and initializes properly in the browser.

```js
marko({ runtimeId: "MY_MARKO_RUNTIME_ID" });
```

### options.linked

Set this to `false` to opt out of [linked mode](#linked-mode). When this is false, the plugin will only handle resolving and transforming `.marko` files.

## Code of Conduct

This project adheres to the [eBay Code of Conduct](./.github/CODE_OF_CONDUCT.md). By participating in this project you agree to abide by its terms.
